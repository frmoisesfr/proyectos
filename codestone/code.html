<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeStone - Juego de Cartas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: radial-gradient(ellipse at top, #1a0f3e 0%, #0a0520 50%, #000000 100%);
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        /* Estrellas de fondo */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Pantalla de inicio */
        #start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a0f3e 0%, #2d1b69 50%, #1a0f3e 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #start-screen.hidden {
            animation: fadeOut 0.8s ease forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; pointer-events: none; }
        }

        .start-title {
            font-size: 64px;
            font-weight: bold;
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 50%, #ff6b35 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            animation: titleGlow 2s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        .start-subtitle {
            font-size: 18px;
            color: #a78bfa;
            margin-bottom: 40px;
            text-align: center;
            padding: 0 20px;
        }

        .start-button {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: white;
            border: 3px solid #a78bfa;
            padding: 20px 60px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.5);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .start-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(124, 58, 237, 0.8);
            border-color: #ffd700;
        }

        /* Contenedor principal del juego */
        #game-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 10px;
            gap: 10px;
            position: relative;
            z-index: 1;
        }

        /* Panel de informaci√≥n mejorado */
        .player-info {
            background: linear-gradient(135deg, 
                rgba(17, 24, 39, 0.95) 0%,
                rgba(45, 27, 105, 0.95) 50%,
                rgba(17, 24, 39, 0.95) 100%);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
            border: 3px solid transparent;
            background-clip: padding-box;
            box-shadow: 
                0 8px 32px rgba(124, 58, 237, 0.4),
                inset 0 0 30px rgba(124, 58, 237, 0.2);
            position: relative;
            overflow: hidden;
        }

        .player-info::before {
            content: "";
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(90deg, 
                #7c3aed 0%, 
                #ffd700 25%, 
                #7c3aed 50%, 
                #ffd700 75%, 
                #7c3aed 100%);
            border-radius: 20px;
            z-index: -1;
            background-size: 200% 100%;
            animation: borderFlow 3s linear infinite;
        }

        @keyframes borderFlow {
            0% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }

        .player-info.ai::before {
            background: linear-gradient(90deg, 
                #dc2626 0%, 
                #fbbf24 25%, 
                #dc2626 50%, 
                #fbbf24 75%, 
                #dc2626 100%);
        }

        .player-info::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(0.8); }
            50% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.2); }
        }

        .info-section {
            display: flex;
            gap: 25px;
            align-items: center;
            z-index: 1;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
        }

        .player-icon {
            font-size: 32px;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.8));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            text-shadow: 0 0 20px currentColor;
            position: relative;
            display: inline-block;
        }

        .health { 
            color: #fbbf24;
            filter: drop-shadow(0 0 15px #fbbf24);
        }

        .energy { 
            color: #60a5fa;
            filter: drop-shadow(0 0 15px #60a5fa);
        }

        /* Zona de campo de batalla */
        .battlefield {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-height: 0;
            position: relative;
        }

        .field-zone {
            flex: 1;
            background: linear-gradient(135deg, 
                rgba(17, 24, 39, 0.5) 0%,
                rgba(45, 27, 105, 0.3) 100%);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 8px;
            display: flex;
            gap: 8px;
            overflow-x: auto;
            overflow-y: hidden;
            align-items: center;
            position: relative;
            border: 2px solid rgba(124, 58, 237, 0.3);
            box-shadow: inset 0 2px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .field-zone.drag-over {
            border-color: #ffd700;
            background: rgba(124, 58, 237, 0.2);
            box-shadow: 
                inset 0 2px 20px rgba(124, 58, 237, 0.5),
                0 0 30px rgba(255, 215, 0, 0.5);
        }

        .field-zone.ai-field {
            border-color: rgba(220, 38, 38, 0.3);
        }

        /* Cartas en el campo */
        .field-card {
            min-width: 80px;
            width: 80px;
            height: 110px;
            background: linear-gradient(135deg, 
                rgba(30, 27, 75, 0.95) 0%,
                rgba(15, 10, 45, 0.95) 100%);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 2px solid #7c3aed;
            padding: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 
                0 4px 15px rgba(124, 58, 237, 0.4),
                inset 0 1px 0 rgba(167, 139, 250, 0.2);
        }

        .field-card:hover {
            transform: translateY(-8px) scale(1.05);
            border-color: #a78bfa;
            box-shadow: 
                0 12px 30px rgba(124, 58, 237, 0.6),
                inset 0 1px 0 rgba(167, 139, 250, 0.3);
        }

        .field-card.ai-card {
            border-color: #dc2626;
            box-shadow: 
                0 4px 15px rgba(220, 38, 38, 0.4),
                inset 0 1px 0 rgba(248, 113, 113, 0.2);
        }

        .field-card.ai-card:hover {
            border-color: #f87171;
            box-shadow: 
                0 12px 30px rgba(220, 38, 38, 0.6),
                inset 0 1px 0 rgba(248, 113, 113, 0.3);
        }

        .field-card.selected {
            border-color: #ffd700;
            box-shadow: 
                0 0 30px rgba(255, 215, 0, 0.9),
                inset 0 0 20px rgba(255, 215, 0, 0.2);
            transform: translateY(-8px) scale(1.08);
            animation: selectedGlow 1.5s ease-in-out infinite;
        }

        @keyframes selectedGlow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.9), inset 0 0 20px rgba(255, 215, 0, 0.2);
            }
            50% { 
                box-shadow: 0 0 50px rgba(255, 215, 0, 1), inset 0 0 30px rgba(255, 215, 0, 0.3);
            }
        }

        .field-card.attackable {
            border-color: #dc2626;
            animation: attackGlow 1s ease-in-out infinite;
            cursor: crosshair;
        }

        @keyframes attackGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(220, 38, 38, 0.6);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(220, 38, 38, 1);
                transform: scale(1.05);
            }
        }

        .card-name {
            font-size: 10px;
            font-weight: bold;
            color: #a78bfa;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            text-shadow: 0 0 10px rgba(167, 139, 250, 0.8);
        }

        .ai-card .card-name {
            color: #f87171;
            text-shadow: 0 0 10px rgba(248, 113, 113, 0.8);
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
            font-weight: bold;
        }

        .card-attack {
            color: #fbbf24;
            text-shadow: 0 0 10px #fbbf24;
        }

        .card-health {
            color: #60a5fa;
            text-shadow: 0 0 10px #60a5fa;
        }

        .card-status {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            opacity: 0.6;
        }

        /* Zona de mano del jugador en abanico */
        .hand-container {
            position: fixed;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            max-width: 95vw;
            z-index: 100;
            transition: all 0.4s ease;
        }

        .hand-container.collapsed {
            bottom: 10px;
        }

        .hand-toggle {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: white;
            border: 2px solid #a78bfa;
            padding: 10px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 auto;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .hand-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.7);
            border-color: #ffd700;
        }

        .hand-zone {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 0;
            position: relative;
            height: 180px;
            perspective: 1000px;
        }

        .hand-container.collapsed .hand-zone {
            display: none;
        }

        .hand-card {
            width: 90px;
            height: 130px;
            background: linear-gradient(135deg, 
                rgba(30, 27, 75, 0.98) 0%,
                rgba(45, 27, 105, 0.98) 100%);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            border: 2px solid #7c3aed;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: grab;
            transition: all 0.3s ease;
            position: absolute;
            bottom: 0;
            box-shadow: 
                0 8px 25px rgba(124, 58, 237, 0.5),
                inset 0 1px 0 rgba(167, 139, 250, 0.3);
        }

        .hand-card:active {
            cursor: grabbing;
        }

        .hand-card.dragging {
            opacity: 0.7;
            transform: rotate(0deg) !important;
            z-index: 1000;
            cursor: grabbing;
            box-shadow: 0 15px 40px rgba(124, 58, 237, 0.8);
        }

        .hand-card:hover {
            transform: translateY(-30px) scale(1.15) rotate(0deg) !important;
            z-index: 50;
            border-color: #a78bfa;
            box-shadow: 
                0 15px 40px rgba(124, 58, 237, 0.8),
                inset 0 1px 0 rgba(167, 139, 250, 0.4);
        }

        .hand-card.unplayable {
            opacity: 0.4;
            cursor: not-allowed;
            filter: grayscale(0.7);
        }

        .hand-card.unplayable:hover {
            transform: translateY(-10px) scale(1.05) !important;
            box-shadow: 0 8px 25px rgba(124, 58, 237, 0.3);
        }

        .card-cost {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            border: 2px solid #dbeafe;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.6);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .card-type {
            font-size: 9px;
            color: #9ca3af;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Bot√≥n de turno */
        .turn-button {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: white;
            border: 2px solid #a78bfa;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 6px 25px rgba(124, 58, 237, 0.5);
            position: relative;
            overflow: hidden;
            z-index: 10;
        }

        .turn-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.7);
            border-color: #ffd700;
        }

        .turn-button:disabled {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            cursor: not-allowed;
            opacity: 0.5;
            border-color: #4b5563;
            box-shadow: none;
        }

        .turn-button:disabled:hover {
            transform: none;
        }

        /* Mensajes del juego */
        .game-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: linear-gradient(135deg, 
                rgba(17, 24, 39, 0.98) 0%,
                rgba(45, 27, 105, 0.98) 100%);
            backdrop-filter: blur(20px);
            color: white;
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #7c3aed;
            z-index: 1000;
            text-align: center;
            min-width: 320px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.9);
            animation: messageAppear 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes messageAppear {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .game-message h2 {
            margin-bottom: 25px;
            font-size: 32px;
            background: linear-gradient(135deg, #ffd700 0%, #ffa500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .game-message button {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            color: white;
            border: 2px solid #a78bfa;
            padding: 12px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 6px 25px rgba(124, 58, 237, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .game-message button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(124, 58, 237, 0.7);
        }

        /* Animaciones */
        @keyframes dealCard {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card-dealing {
            animation: dealCard 0.5s ease;
        }

        @keyframes attack {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-30px) scale(1.2); }
            100% { transform: translateY(0) scale(1); }
        }

        .attacking {
            animation: attack 0.6s ease;
            z-index: 100;
        }

        /* Responsive para escritorio */
        @media (min-width: 768px) {
            #game-container {
                padding: 15px;
                gap: 12px;
            }

            .field-card {
                min-width: 100px;
                width: 100px;
                height: 135px;
            }

            .hand-card {
                width: 110px;
                height: 155px;
            }

            .start-title {
                font-size: 80px;
            }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(17, 24, 39, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Estrellas de fondo -->
    <div class="stars" id="stars"></div>

    <!-- Pantalla de inicio -->
    <div id="start-screen">
        <div class="start-title">‚ö° CODESTONE ‚ö°</div>
        <div class="start-subtitle">Juego de Cartas Estrat√©gico<br>Tem√°tica Inform√°tica</div>
        <button class="start-button" id="start-game-btn">COMENZAR PARTIDA</button>
    </div>

    <div id="game-container" style="display: none;">
        <!-- Informaci√≥n de la IA -->
        <div class="player-info ai">
            <div class="info-section">
                <div class="player-icon">ü§ñ</div>
                <div class="stat">
                    <span class="stat-value health" id="ai-health">30</span>
                    <span>‚ù§Ô∏è VIDA</span>
                </div>
                <div class="stat">
                    <span class="stat-value energy" id="ai-energy">0/0</span>
                    <span>‚ö° ENERG√çA</span>
                </div>
            </div>
            <div class="info-section">
                <div class="stat">
                    <span id="ai-deck-count">20</span>
                    <span>üìö MAZO</span>
                </div>
            </div>
        </div>

        <!-- Campo de batalla -->
        <div class="battlefield">
            <div class="field-zone ai-field" id="ai-field"></div>
            <div class="field-zone player-field" id="player-field" data-drop-zone="player"></div>
        </div>

        <!-- Informaci√≥n del jugador -->
        <div class="player-info">
            <div class="info-section">
                <div class="player-icon">üë®‚Äçüíª</div>
                <div class="stat">
                    <span class="stat-value health" id="player-health">30</span>
                    <span>‚ù§Ô∏è VIDA</span>
                </div>
                <div class="stat">
                    <span class="stat-value energy" id="player-energy">0/0</span>
                    <span>‚ö° ENERG√çA</span>
                </div>
            </div>
            <div class="info-section">
                <div class="stat">
                    <span id="player-deck-count">20</span>
                    <span>üìö MAZO</span>
                </div>
            </div>
        </div>

        <!-- Bot√≥n de terminar turno -->
        <button class="turn-button" id="end-turn-button">TERMINAR TURNO</button>

        <!-- Mano del jugador -->
        <div class="hand-container" id="hand-container">
            <button class="hand-toggle" id="hand-toggle">‚ñº MANO</button>
            <div class="hand-zone" id="player-hand"></div>
        </div>
    </div>

    <script>
        // ==========================================
        // CREAR ESTRELLAS
        // ==========================================
        function createStars() {
            const starsContainer = document.getElementById('stars');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.animationDelay = `${Math.random() * 3}s`;
                starsContainer.appendChild(star);
            }
        }

        createStars();

        // ==========================================
        // PANTALLA DE INICIO
        // ==========================================
        document.getElementById('start-game-btn').addEventListener('click', () => {
            document.getElementById('start-screen').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('game-container').style.display = 'flex';
                game = new Game();
            }, 800);
        });

        // ==========================================
        // CONFIGURACI√ìN DEL JUEGO
        // ==========================================
        const CONFIG = {
            STARTING_HEALTH: 30,
            STARTING_HAND_SIZE: 4,
            MAX_ENERGY: 10,
            MAX_HAND_SIZE: 10,
            MAX_FIELD_SIZE: 7
        };

        // ==========================================
        // DEFINICI√ìN DE CARTAS
        // ==========================================
        const CARD_DATABASE = [
            { id: 1, name: "RAM", type: "creature", cost: 1, attack: 1, health: 2 },
            { id: 2, name: "CPU", type: "creature", cost: 2, attack: 2, health: 2 },
            { id: 3, name: "GPU", type: "creature", cost: 3, attack: 3, health: 3 },
            { id: 4, name: "SSD", type: "creature", cost: 2, attack: 2, health: 3 },
            { id: 5, name: "Firewall", type: "creature", cost: 4, attack: 2, health: 6 },
            { id: 6, name: "Router", type: "creature", cost: 3, attack: 3, health: 2 },
            { id: 7, name: "Switch", type: "creature", cost: 2, attack: 1, health: 4 },
            { id: 8, name: "Servidor", type: "creature", cost: 5, attack: 4, health: 5 },
            { id: 9, name: "Bit", type: "creature", cost: 1, attack: 1, health: 1 },
            { id: 10, name: "Byte", type: "creature", cost: 2, attack: 2, health: 2 },
            { id: 11, name: "Debug", type: "spell", cost: 1, effect: "damage", value: 2 },
            { id: 12, name: "Reboot", type: "spell", cost: 2, effect: "heal", value: 4 },
            { id: 13, name: "Virus", type: "spell", cost: 3, effect: "damage", value: 4 },
            { id: 14, name: "Patch", type: "spell", cost: 2, effect: "heal", value: 3 }
        ];

        // ==========================================
        // CLASE JUGADOR
        // ==========================================
        class Player {
            constructor(isAI = false) {
                this.isAI = isAI;
                this.health = CONFIG.STARTING_HEALTH;
                this.maxEnergy = 0;
                this.currentEnergy = 0;
                this.deck = this.createDeck();
                this.hand = [];
                this.field = [];
            }

            createDeck() {
                const deck = [];
                for (let i = 0; i < 20; i++) {
                    const cardTemplate = CARD_DATABASE[i % CARD_DATABASE.length];
                    deck.push({
                        ...cardTemplate,
                        uniqueId: `${cardTemplate.id}_${Date.now()}_${i}`,
                        currentHealth: cardTemplate.health || 0,
                        canAttack: false
                    });
                }
                return deck.sort(() => Math.random() - 0.5);
            }

            drawCard() {
                if (this.deck.length > 0 && this.hand.length < CONFIG.MAX_HAND_SIZE) {
                    const card = this.deck.pop();
                    this.hand.push(card);
                    return card;
                }
                return null;
            }

            playCard(cardIndex, targetPlayer = null, targetCard = null) {
                const card = this.hand[cardIndex];
                if (!card || card.cost > this.currentEnergy) return false;

                this.currentEnergy -= card.cost;
                this.hand.splice(cardIndex, 1);

                if (card.type === "creature") {
                    if (this.field.length < CONFIG.MAX_FIELD_SIZE) {
                        card.canAttack = false;
                        this.field.push(card);
                    }
                } else if (card.type === "spell") {
                    this.castSpell(card, targetPlayer, targetCard);
                }
                return true;
            }

            castSpell(card, targetPlayer, targetCard) {
                if (card.effect === "damage") {
                    if (targetCard) {
                        targetCard.currentHealth -= card.value;
                    } else if (targetPlayer) {
                        targetPlayer.health -= card.value;
                    }
                } else if (card.effect === "heal") {
                    this.health = Math.min(CONFIG.STARTING_HEALTH, this.health + card.value);
                }
            }

            attack(attackerIndex, defender, defenderCardIndex = null) {
                const attacker = this.field[attackerIndex];
                if (!attacker || !attacker.canAttack) return false;

                attacker.canAttack = false;

                if (defenderCardIndex !== null && defender.field[defenderCardIndex]) {
                    const defenderCard = defender.field[defenderCardIndex];
                    defenderCard.currentHealth -= attacker.attack;
                    attacker.currentHealth -= defenderCard.attack;
                } else {
                    defender.health -= attacker.attack;
                }
                return true;
            }

            startTurn() {
                if (this.maxEnergy < CONFIG.MAX_ENERGY) {
                    this.maxEnergy++;
                }
                this.currentEnergy = this.maxEnergy;
                this.field.forEach(card => card.canAttack = true);
                this.drawCard();
            }

            cleanupField() {
                this.field = this.field.filter(card => card.currentHealth > 0);
            }
        }

        // ==========================================
        // GESTOR DEL JUEGO
        // ==========================================
        class Game {
            constructor() {
                this.player = new Player(false);
                this.ai = new Player(true);
                this.currentTurn = "player";
                this.selectedFieldCard = null;
                this.gameOver = false;
                this.draggedCard = null;
                
                this.initializeGame();
                this.setupEventListeners();
            }

            initializeGame() {
                for (let i = 0; i < CONFIG.STARTING_HAND_SIZE; i++) {
                    this.player.drawCard();
                    this.ai.drawCard();
                }
                this.player.startTurn();
                this.render();
            }

            setupEventListeners() {
                document.getElementById("end-turn-button").addEventListener("click", () => {
                    if (this.currentTurn === "player" && !this.gameOver) {
                        this.endTurn();
                    }
                });

                document.getElementById("hand-toggle").addEventListener("click", () => {
                    const container = document.getElementById("hand-container");
                    container.classList.toggle("collapsed");
                    const button = document.getElementById("hand-toggle");
                    button.textContent = container.classList.contains("collapsed") ? "‚ñ≤ MANO" : "‚ñº MANO";
                });

                const playerField = document.getElementById("player-field");
                playerField.addEventListener("dragover", (e) => {
                    e.preventDefault();
                    playerField.classList.add("drag-over");
                });

                playerField.addEventListener("dragleave", () => {
                    playerField.classList.remove("drag-over");
                });

                playerField.addEventListener("drop", (e) => {
                    e.preventDefault();
                    playerField.classList.remove("drag-over");
                    
                    if (this.draggedCard !== null) {
                        this.playCardFromHand(this.draggedCard);
                        this.draggedCard = null;
                    }
                });

                const aiInfo = document.querySelector(".player-info.ai");
                aiInfo.addEventListener("click", () => {
                    if (this.selectedFieldCard !== null) {
                        this.attackWithFieldCard(null);
                    }
                });
            }

            playCardFromHand(cardIndex) {
                if (this.currentTurn !== "player" || this.gameOver) return;

                const card = this.player.hand[cardIndex];
                
                if (card.type === "spell") {
                    if (card.effect === "damage") {
                        if (this.ai.field.length > 0) {
                            const randomTarget = Math.floor(Math.random() * this.ai.field.length);
                            this.player.playCard(cardIndex, null, this.ai.field[randomTarget]);
                        } else {
                            this.player.playCard(cardIndex, this.ai, null);
                        }
                    } else if (card.effect === "heal") {
                        this.player.playCard(cardIndex, null, null);
                    }
                } else {
                    this.player.playCard(cardIndex);
                }

                this.player.cleanupField();
                this.ai.cleanupField();
                this.checkGameOver();
                this.render();
            }

            selectFieldCard(cardIndex) {
                if (this.currentTurn !== "player" || this.gameOver) return;

                const card = this.player.field[cardIndex];
                if (!card || !card.canAttack) return;

                this.selectedFieldCard = cardIndex;
                this.render();
            }

            attackWithFieldCard(targetIndex = null) {
                if (this.selectedFieldCard === null || this.currentTurn !== "player") return;

                const attackerElement = document.querySelector(`[data-field-index="${this.selectedFieldCard}"]`);
                if (attackerElement) {
                    attackerElement.classList.add("attacking");
                }

                setTimeout(() => {
                    this.player.attack(this.selectedFieldCard, this.ai, targetIndex);
                    this.selectedFieldCard = null;
                    this.player.cleanupField();
                    this.ai.cleanupField();
                    this.checkGameOver();
                    this.render();
                }, 600);
            }

            endTurn() {
                this.selectedFieldCard = null;
                this.currentTurn = "ai";
                this.render();
                setTimeout(() => this.aiTurn(), 1000);
            }

            aiTurn() {
                this.ai.startTurn();
                this.render();

                setTimeout(() => {
                    while (this.ai.hand.length > 0 && this.ai.currentEnergy > 0) {
                        const playableCards = this.ai.hand
                            .map((card, index) => ({ card, index }))
                            .filter(item => item.card.cost <= this.ai.currentEnergy);

                        if (playableCards.length === 0) break;

                        const randomCard = playableCards[Math.floor(Math.random() * playableCards.length)];
                        
                        if (randomCard.card.type === "spell") {
                            if (randomCard.card.effect === "damage") {
                                if (this.player.field.length > 0) {
                                    const target = Math.floor(Math.random() * this.player.field.length);
                                    this.ai.playCard(randomCard.index, null, this.player.field[target]);
                                } else {
                                    this.ai.playCard(randomCard.index, this.player, null);
                                }
                            } else {
                                this.ai.playCard(randomCard.index, null, null);
                            }
                        } else {
                            this.ai.playCard(randomCard.index);
                        }
                        this.render();
                    }

                    for (let i = 0; i < this.ai.field.length; i++) {
                        if (this.ai.field[i].canAttack) {
                            if (this.player.field.length > 0 && Math.random() > 0.3) {
                                const target = Math.floor(Math.random() * this.player.field.length);
                                this.ai.attack(i, this.player, target);
                            } else {
                                this.ai.attack(i, this.player);
                            }
                        }
                    }

                    setTimeout(() => {
                        this.player.cleanupField();
                        this.ai.cleanupField();
                        this.checkGameOver();
                        this.currentTurn = "player";
                        this.player.startTurn();
                        this.render();
                    }, 800);
                }, 1500);
            }

            checkGameOver() {
                if (this.player.health <= 0) {
                    this.gameOver = true;
                    this.showGameOver("¬°LA IA HA GANADO!");
                } else if (this.ai.health <= 0) {
                    this.gameOver = true;
                    this.showGameOver("¬°HAS GANADO!");
                }
            }

            showGameOver(message) {
                const messageDiv = document.createElement("div");
                messageDiv.className = "game-message";
                messageDiv.innerHTML = `
                    <h2>${message}</h2>
                    <p>Puntos de vida finales:</p>
                    <p>Jugador: ${Math.max(0, this.player.health)} ‚ù§Ô∏è</p>
                    <p>IA: ${Math.max(0, this.ai.health)} ‚ù§Ô∏è</p>
                    <button onclick="location.reload()">JUGAR DE NUEVO</button>
                `;
                document.body.appendChild(messageDiv);
            }

            render() {
                this.renderPlayerInfo();
                this.renderAIInfo();
                this.renderHand();
                this.renderField();
                this.renderTurnButton();
            }

            renderPlayerInfo() {
                document.getElementById("player-health").textContent = Math.max(0, this.player.health);
                document.getElementById("player-energy").textContent = 
                    `${this.player.currentEnergy}/${this.player.maxEnergy}`;
                document.getElementById("player-deck-count").textContent = this.player.deck.length;
            }

            renderAIInfo() {
                document.getElementById("ai-health").textContent = Math.max(0, this.ai.health);
                document.getElementById("ai-energy").textContent = 
                    `${this.ai.currentEnergy}/${this.ai.maxEnergy}`;
                document.getElementById("ai-deck-count").textContent = this.ai.deck.length;
            }

            renderHand() {
                const handZone = document.getElementById("player-hand");
                handZone.innerHTML = "";

                const totalCards = this.player.hand.length;
                const maxRotation = 25;
                const rotationStep = totalCards > 1 ? (maxRotation * 2) / (totalCards - 1) : 0;
                const spacing = 40;

                this.player.hand.forEach((card, index) => {
                    const cardElement = document.createElement("div");
                    cardElement.className = "hand-card card-dealing";
                    cardElement.draggable = true;
                    
                    if (card.cost > this.player.currentEnergy || this.currentTurn !== "player") {
                        cardElement.classList.add("unplayable");
                        cardElement.draggable = false;
                    }

                    const rotation = -maxRotation + (index * rotationStep);
                    const leftOffset = index * spacing - (totalCards - 1) * spacing / 2;
                    const verticalOffset = Math.abs(rotation) * 1.5;

                    cardElement.style.transform = `rotate(${rotation}deg)`;
                    cardElement.style.left = `calc(50% + ${leftOffset}px)`;
                    cardElement.style.bottom = `${verticalOffset}px`;

                    cardElement.innerHTML = `
                        <div class="card-cost">${card.cost}</div>
                        <div class="card-name">${card.name}</div>
                        <div class="card-type">${card.type === "creature" ? "CRIATURA" : "HECHIZO"}</div>
                        ${card.type === "creature" ? `
                            <div class="card-stats">
                                <span class="card-attack">${card.attack}‚öîÔ∏è</span>
                                <span class="card-health">${card.health}‚ù§Ô∏è</span>
                            </div>
                        ` : `
                            <div style="text-align: center; font-size: 11px; color: #fbbf24;">
                                ${card.effect === "damage" ? `üí• ${card.value} da√±o` : `üíö ${card.value} vida`}
                            </div>
                        `}
                    `;

                    cardElement.addEventListener("dragstart", (e) => {
                        if (!cardElement.classList.contains("unplayable")) {
                            this.draggedCard = index;
                            cardElement.classList.add("dragging");
                        }
                    });

                    cardElement.addEventListener("dragend", () => {
                        cardElement.classList.remove("dragging");
                    });

                    if (card.cost <= this.player.currentEnergy && this.currentTurn === "player") {
                        cardElement.addEventListener("click", () => this.playCardFromHand(index));
                    }

                    handZone.appendChild(cardElement);
                });
            }

            renderField() {
                const playerField = document.getElementById("player-field");
                playerField.innerHTML = "";

                this.player.field.forEach((card, index) => {
                    const cardElement = this.createFieldCard(card, index, false);
                    playerField.appendChild(cardElement);
                });

                const aiField = document.getElementById("ai-field");
                aiField.innerHTML = "";

                this.ai.field.forEach((card, index) => {
                    const cardElement = this.createFieldCard(card, index, true);
                    aiField.appendChild(cardElement);
                });
            }

            createFieldCard(card, index, isAI) {
                const cardElement = document.createElement("div");
                cardElement.className = `field-card ${isAI ? "ai-card" : ""}`;
                cardElement.setAttribute("data-field-index", index);

                if (!isAI && this.selectedFieldCard === index) {
                    cardElement.classList.add("selected");
                }

                if (!isAI && this.selectedFieldCard !== null && isAI) {
                    cardElement.classList.add("attackable");
                }

                cardElement.innerHTML = `
                    <div class="card-name">${card.name}</div>
                    <div class="card-stats">
                        <span class="card-attack">${card.attack}‚öîÔ∏è</span>
                        <span class="card-health">${card.currentHealth}‚ù§Ô∏è</span>
                    </div>
                    ${!card.canAttack && !isAI ? '<div class="card-status">üí§</div>' : ''}
                `;

                if (!isAI) {
                    cardElement.addEventListener("click", () => {
                        if (this.selectedFieldCard === null) {
                            this.selectFieldCard(index);
                        }
                    });
                } else if (this.selectedFieldCard !== null) {
                    cardElement.addEventListener("click", () => {
                        this.attackWithFieldCard(index);
                    });
                }

                return cardElement;
            }

            renderTurnButton() {
                const button = document.getElementById("end-turn-button");
                button.disabled = this.currentTurn !== "player" || this.gameOver;
                button.textContent = this.currentTurn === "player" ? 
                    "TERMINAR TURNO" : "TURNO DE LA IA...";
            }
        }

        let game;
    </script>
</body>
</html>
